# Environment
```
# check current directory...
pwd
```
# Prepare
```
# installing packages...
npm install
# copying test env...
cp /srv/expansyon-backend/dotenv/.env.test .env
# starting pm2 test server...
pm2 start ./bin/server.js --name expansyon-backend-test
```
# Test
```
# wait for fixtures to load before running tests...
sleep 10 && npm run test
```
# Deploy
```
# get current date...
NOW=$(date +"%F_%H%M%S")
# copy this build to new folder...
cp -r $PWD /srv/expansyon-backend/build-$NOW
# copy production dotenv to this new folder...
cp /srv/expansyon-backend/dotenv/.env.production /srv/expansyon-backend/build-$NOW/.env
# move to this new folder...
cd /srv/expansyon-backend/build-$NOW
# remove latest build softlink...
rm -r /srv/expansyon-backend/current
# create new latest build softlink...
ln -s /srv/expansyon-backend/build-$NOW /srv/expansyon-backend/current
# restart pm2 production server with new latest build...
pm2 restart expansyon-backend
```
# Cleanup
```
# stopping pm2 test server...
pm2 stop expansyon-backend-test
# removing pm2 test server...
pm2 delete expansyon-backend-test
```